<html>

<style>

    canvas {
        padding: 0;
        margin: auto;
    	position: absolute;
    	top: 10px;
    	left: 10px;
        background-image: url("art_icons/transparency.png");
        background-repeat: round;
        border:5px solid rgb(150,150,150);
    }
    .cset {
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: auto;
        height: auto;
        background-color: rgb(175,175,175);
        border: 5px solid rgb(150,150,150);
    }
    label {
        font-size: 14px;
    }
    .slider {
        width: 85%;
    }
    hr {
        width: 90%;
    }
    .sidebar {
        position: absolute;
        top: 10px;
        right: 10px;
        height: auto;
        width: auto;
        background-color: rgb(175,175,175);
        border: 5px solid rgb(150,150,150);
    }
    body {
        background-color: rgb(100,100,100)
    }
    button {
        cursor: pointer;
    }    
    .brAll {
        background-color: rgb(150,150,150); 
        border: 3px solid #afafaf;
        width: 38px;
        height: 38px;
    }
    .br0 {
        background-image: url("art_icons/square.png");
    }
    .br1 {
        background-image: url("art_icons/circle.png");
    }
    .br2 {
        background-image: url("art_icons/e_square.png");
    }
    .br3 {
        background-image: url("art_icons/e_circle.png");
    }
    
</style>
	
<head>
    <title>Art</title>
</head>
    
<body onmousemove="getCoords(event)">

<div class="cset">
    <table align="center">
    <tr>
        <th><label>Width:</label></th>
        <th colspan="2"><input type="number" step="1" value="960" id="setWidth"></th>
    </tr>
    <tr>
        <th><label>Height:</label></th>
        <th colspan="2"><input type="number" step="1" value="540" id="setHeight"></th>
    </tr>
    <tr>
        <th colspan="3"><button onmousedown="start()" id="resButton">Ready!</button></th>
    </tr>
    </table>
</div>
    
<div class="sidebar">

    <table align="center">
        <tr>
            <th colspan="4"><label>Brush Color</label></th>
        </tr>
        <tr>
            <th>R:</th>
            <th colspan="3"><input type="range" min="0" max="255" value="0" step="1" id="redSelect colorSelect" class="slider"></th>
        </tr>
        <tr>
            <th>G:</th>
            <th colspan="3"><input type="range" min="0" max="255" value="0" step="1" id="greenSelect colorSelect" class="slider"></th>
        </tr>
        <tr>
            <th>B:</th>
            <th colspan="3"><input type="range" min="0" max="255" value="0" step="1" id="blueSelect colorSelect" class="slider"></th>
        </tr>
        <tr>
            <th colspan="4" style="background:white;" id="colorShow"><p id="testPara"></p></th>
        </tr>
    </table>
    
    <hr>
    
    <table align="center">
        <tr>
            <th><label>Brush Size: <span id="sizeTxt"></span></label></th>
        </tr>
        <tr>
            <th><input type="range" min="1" max="100" value="20" step="1" id="brushRange" class="slider"></th>
        </tr>
    </table>
    
    <hr>
	
    <table align="center">
        <tr>
            <th><label>Opacity: <span id="alphaTxt"></span></label></th>
        </tr>
        <tr>
            <th><input type="range" min="0" max="1" value="1" step=".01" id="brushAlpha" class="slider"></th>
        </tr>
    </table>
    
    <hr>
    
    <table align="center">
        <tr>
            <th colspan="2"><label>Brush Type</label></th>
        </tr>
        <tr>
            <th><button onmousedown="brushChange(0)" id="br0" class="brAll br0"></button></th>
            <!--Add separate buttons for shape and mode (make better pls)-->
            <th><button onmousedown="brushChange(1)" id="br1" class="brAll br1"></button></th>
        </tr>
        <tr>
            <th><button onmousedown="brushChange(2)" id="br2" class="brAll br2"></button></th>
            <th><button onmousedown="brushChange(3)" id="br3" class="brAll br3"></button></th>
        </tr>
    </table>

    <hr>
    
    <table align="center" style="padding:0px 0px 5px;">
        <tr>
            <th><button onmousedown="undoStroke()">Undo</button></th>
        </tr>
    </table>
    
</div>

<script>
	
    //General canvas reference
    //https://www.w3schools.com/tags/ref_canvas.asp
    //----
    //Select area to draw
    //https://www.w3schools.com/code/tryit.asp?filename=G3ECBL9TW86S
    //----
    //Better circle/square brush (won't work for custom shape brushes)
    //https://www.w3schools.com/code/tryit.asp?filename=G3ECCXZMBM0A
    //----
    //Change canvas 0,0 (useful when brush gets offset
    //https://www.w3schools.com/tags/tryit.asp?filename=tryhtml5_canvas_translate
    //----
    //Custom brush!
    //https://www.w3schools.com/code/tryit.asp?filename=G3ECJMPPRT15
	
    var brush;
    var draw = false;
    var mouseX;
    var mouseY;
    var runSpeed = 1;
    var canvasWidth = 960;
    var canvasHeight = 540;
    var brushSize = 20;
    var brushType = 0;
    var brushShape = 1;
    var brushColor;
    var later = false;
    var brushAlpha = 1;
    var newStroke = true;
    var lastImage;
    var undoLast = false;
    window.addEventListener('mousedown', function() {
        draw = true;
        getCoords(event);
    });
    
    window.addEventListener('mouseup', function() {
        draw = false;
        newStroke = true;
    });
    
    function start() {
        if (later) {
            var check = confirm("Are you sure?");
            if (check) {
                area.clear();
                brushChange(3);
                draw = false;
                newStroke = true;
            }
        } else {
            document.getElementById("br1").style.border = "3px solid #42a9f7";
            document.getElementById("br1").style.cursor = "default";
        }
        later = true;
        document.getElementById("resButton").innerHTML = "Reset Canvas";
        
        brush = new component(brushSize, brushSize, "rgb(0,0,0)", -brushSize, -brushSize);
        area.start();
    }
	
    var area = {
        canvas : document.createElement("canvas"),
        start : function() {
            this.canvas.width = canvasWidth;
            this.canvas.height = canvasHeight;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = setInterval(updateArea, runSpeed);
        },
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        }
    }
    
    function component(width, height, color, x, y) {
        this.width = width;
        this.height = height;
        this.x = x;
        this.y = y;    
        this.update = function() {
            ctx = area.context;
            ctx.strokeStyle = brushColor;
            ctx.globalAlpha = brushAlpha;
            ctx.lineWidth = brushSize;
            
            if (brushShape == 0) {
                ctx.lineJoin = "miter";
                ctx.lineCap = "square";
            } else if (brushShape == 1) {
                ctx.lineJoin = "round";
                ctx.lineCap = "round";
            }
            
            if (brushType == 0) {
                ctx.globalCompositeOperation = 'source-over';
            } else {
                ctx.globalCompositeOperation = 'destination-out';
            }
            if (draw) {
                if (newStroke) {
                    lastImage = ctx.getImageData(0, 0, canvasWidth, canvasHeight)
                    ctx.beginPath();
                    ctx.moveTo(oldX,oldY);
                }
                
                newStroke = false;
                
                ctx.lineTo(mouseX,mouseY);
            
                ctx.stroke();
            }
            if (undoLast) {
                area.clear();
                ctx.putImageData(lastImage, 0, 0);
                undoLast = false;
            }
            
    	}   
    }
    
    function updateArea() {   
    	brush.update();
    }
	
    function getCoords(event) {
        oldX = mouseX;
        oldY = mouseY;
        mouseX = event.clientX - 15;
        mouseY = event.clientY - 15;
    }
    
    function brushChange(n) {
        if (n == 0) { //Make better buttons then fix this
            brushType = 0;
            brushShape = 0;
        } else if (n == 1) {
            brushType = 0;
            brushShape = 1;
        } else if (n == 2) {
            brushType = 1;
            brushShape = 0;
        } else {
            brushType = 1;
            brushShape = 1;
        }
        
        if (n == 0) {
            document.getElementById("br0").style.border = "3px solid #42a9f7";
            document.getElementById("br0").style.cursor = "default";
            
            document.getElementById("br1").style.border = "";
            document.getElementById("br2").style.border = "";
            document.getElementById("br3").style.border = "";
            document.getElementById("br1").style.cursor = "";
            document.getElementById("br2").style.cursor = "";
            document.getElementById("br3").style.cursor = "";
        } else if (n == 1) {
            document.getElementById("br1").style.border = "3px solid #42a9f7";
            document.getElementById("br1").style.cursor = "default";
            
            document.getElementById("br0").style.border = "";
            document.getElementById("br2").style.border = "";
            document.getElementById("br3").style.border = "";
            document.getElementById("br0").style.cursor = "";
            document.getElementById("br2").style.cursor = "";
            document.getElementById("br3").style.cursor = "";
        } else if (n == 2) {
            document.getElementById("br2").style.border = "3px solid #42a9f7";
            document.getElementById("br2").style.cursor = "default";
            
            document.getElementById("br0").style.border = "";
            document.getElementById("br1").style.border = "";
            document.getElementById("br3").style.border = "";
            document.getElementById("br0").style.cursor = "";
            document.getElementById("br1").style.cursor = "";
            document.getElementById("br3").style.cursor = "";
        } else {
            document.getElementById("br3").style.border = "3px solid #42a9f7";
            document.getElementById("br3").style.cursor = "default";
            
            document.getElementById("br0").style.border = "";
            document.getElementById("br1").style.border = "";
            document.getElementById("br2").style.border = "";
            document.getElementById("br0").style.cursor = "";
            document.getElementById("br1").style.cursor = "";
            document.getElementById("br2").style.cursor = "";
        }
    }
	
    var sizeSlider = document.getElementById("brushRange");
    var sizeIndicator = document.getElementById("sizeTxt");
    sizeIndicator.innerHTML = sizeSlider.value;
    sizeSlider.oninput = function() {
        sizeIndicator.innerHTML = this.value;
        brushSize = this.value;
        brush = new component(brushSize, brushSize, "rgb(0,0,0)", -brushSize, -brushSize);
    }
    
    var alphaSlider = document.getElementById("brushAlpha");
    var alphaIndicator = document.getElementById("alphaTxt");
    alphaIndicator.innerHTML = alphaSlider.value;
    alphaSlider.oninput = function() {
        alphaIndicator.innerHTML = this.value;
        brushAlpha = this.value;
    }
    
    
    var colorPicker = document.getElementById("colorSelect");
    var colorDisplay = document.getElementById("colorShow");
    var redPicker = document.getElementById("redSelect");
    var greenPicker = document.getElementById("greenSelect");
    var bluePicker = document.getElementById("blueSelect");
    redPicker.oninput = function() {
        brushColor = "rgb(" + this.value + "," + this.value + "," + this.value + ")";
        document.getElementById("testPara").innerHTML = brushColor;
        //colorDisplay.style.background = brushColor;
    }
    
    var wSet = document.getElementById("setWidth");
    var hSet = document.getElementById("setHeight");
    wSet.oninput = function() {
        canvasWidth = this.value;
    }
    hSet.oninput = function() {
        canvasHeight = this.value;
    }
    
    function undoStroke() {
        undoLast = true;
    }
        
</script>

</body>

</html>
